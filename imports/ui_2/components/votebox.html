<template name="Votebox">
  <div class="vote-container white-box">
    <div class="vote-tools">
      <div class="tool-up">
        {{#if this.closed}}
        <a class="js-view-results" title={{_ "Show results"}}>
          <span class="glyphicon glyphicon-align-right" aria-hidden="true"></span>
        </a>
        {{else}}
          {{#if userHasPermission 'vote.close' this/communityId this}}
          <a class="js-close" title={{_ "Close"}}>
            <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
          </a>
          {{/if}}
        {{/if}}
        <a class="js-view-proposal" title="Show attachment">
          <span class="glyphicon glyphicon-file" aria-hidden="true"></span>
        </a>
          {{#if userHasPermission 'vote.update' this/communityId this}}
          <a title={{_ "Edit"}}>
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
          </a>
          {{/if}}
        </div>
      <div class="tool-progress" title="{{votedCount}} tag szavazott a {{eligibleVoterCount}}-bÃ³l">
        <div class="progressBar-v">
          <div class="progressLine-v" data-value="{{votedPercent}}">{{votedPercent}} %</div>
        </div>
      </div>
    </div>
    <div class="row vote-title">
      <div class="col-xs-6 title-size">
        {{title}}
      </div>
      {{#if this.closed}}
      <div class="col-xs-6 text-right">
        <small class="writer">
          <i>{{_ 'createdAt'}}: {{displayCreatedAtTime}}</i>
        </small>
        <br>
        <button class="js-view-results">{{_ "closed"}}</button>
      </div>
      {{else}}
      <div class="col-xs-6 small-size text-right" data-tooltip="{{displayClosesAtTime}}">
        <small class="writer">
          <i>{{_ 'createdAt'}}: {{displayCreatedAtTime}}</i>
        </small>
        <br>
        {{_ "closes"}}: {{displayTimeLeft}}
        <!-- <button class="js-close">{{_ "close topic"}}</button> -->
      </div>
      {{/if}}
    </div>
    <div class="row" style="margin-bottom: 20px;">
      <div class="col-xs-12">
        <br>
        {{{renderMarkdown text}}}
      </div>
    </div>
    {{#if this.closed}}
      <div class="row">
        <div class="col-xs-12">
          {{#each sum in this.voteSummaryDisplay}}
          <div>{{_ sum.choice}}: {{sum.votingShare}} ({{percentage sum.votingShare.toNumber}})</div><br>
          {{/each}}
        </div>
      </div>
    {{else}}
      <!-- voting buttons -->
      {{#if userHasPermission 'vote.cast' this/communityId this}}
      <div class="row">
      <div class="col-xs-12 vote-answer">
          
        {{#if voteTypeIs "preferential"}}
        <div class="row vote-answer-sort">
          {{#if voteIsFinalized}}
          {{else}}
            <div class="col-xs-12 text-center">
              {{_ 'rankedVotingInstructions'}}
            </div>
          {{/if}}
          <div class="col-xs-12 col-md-8 col-md-offset-2 text-center">
            <ul class="sortable droptrue {{pressedClassForPreferential}}">
              {{#each currentPreference}}
                <li class="ui-state-default" data-value="{{value}}"> <span class="glyphicon glyphicon-lock" aria-hidden="true"></span> {{text}}</li>
              {{/each}}
            </ul>
          </div>
          <div class="col-xs-12 text-center vsend-col">
            {{#if voteIsFinalized}}
              <button class="btn btn-default btn-votesend">{{_ 'change'}}</button>
            {{else}}
              <button class="btn btn-primary btn-votesend">{{_ 'finalize'}}</button>
            {{/if}}
            <br>
            <br>
            {{> UserVoteStatus}}
          </div>
        </div>

        {{else}}
        <div class="row">
          <div class="col-xs-12 vsend-col">
            <div class="btns-group">
              {{#each choice in vote.choices}}
              <a href="#" class="btn-vote {{pressedClass @index}}" data-value="{{@index}}">
                {{_ choice}}
              </a>
              {{/each}}
            </div>
            <!--button class="btn-primary btn-golive">{{_ 'vote'}}</button-->
            <br>
            <br>
            {{> UserVoteStatus}}
          </div>
        </div>
        {{/if}}
      </div>
      </div>
      {{/if}}

    {{/if}}
      <div class="row">
      <div class="col-xs-12">
        {{> Comments_section topicId=_id}}
      </div>
      </div>

  </div>
</template>

<template name="UserVoteStatus">
  <!-- showing if you voted directly or via delegation -->
  <div class="text-left">
  {{#if this.hasVotedDirect currentUser._id}}
    {{_ "You voted directly"}} - <a class="js-revoke">{{_ "revoke"}}</a>
  {{else}}
    {{#if this.hasVotedIndirect currentUser._id}}
      {{_ "You voted via delegation"}} - ({{_ "votedViaDelegationHint"}})
    {{else}}
      {{_ "You have not yet voted"}} - <i>({{_ "notYetVotedHint"}})</i>
    {{/if}}
  {{/if}}
  </div>
</template>