<template name="Payment_edit">
    <div class="row">
        <!-- hidden, needed for autoform doc data -->
        {{> afQuickField name="communityId" type="hidden"}}
        {{> afQuickField name="category" type="hidden"}}
        {{> afQuickField name="defId" type="hidden"}}
        {{> afQuickField name="relation" type="hidden"}}
        <!-- hidden, needed for autoform doc data -->
        <div class="col-sm-6 col-md-6">
            {{> afQuickField name="valueDate" type=hiddenWhenReconciling defaultValue=defaultDate}}
            {{> afQuickField name="payAccount" type=hiddenWhenReconciling}}
            {{#if reconciling}}
            <div class="form-group">
                <label>{{_ 'schemaStatementEntries.original.label'}}</label><br>
                <div class="well">   
                    {{>Doc_view doc=originalStatementEntry}}
                </div>
            </div>
            {{/if}}
        </div>
        <div class="col-sm-6 col-md-4 pull-right">
            {{#if doc.serialId}}
                <h4>{{_ doc.txdef.name}}:
                <span class="text-navy">{{doc.serialId}}</span></h4>
            {{/if}}
            {{> afQuickField name="partnerId"}}
            {{> afQuickField name="contractId"}}
            {{> afQuickField name="amount"}}
        </div>
    </div>
    <div class="table-responsive m-t">
        <table class="table invoice-table">
            <thead>
                <tr>
                    <th>{{_ 'schemaPayments.bills.label'}}
                      <button type="button" class="btn btn-xs btn-default pull-right js-new" data-entity="bill"><i class="fa fa-plus"></i> {{_ 'new'}} {{_ 'bill'}}</button>
                    </th>
                    <th></th>
                    <th>{{_ 'schemaTransactions.amount.label'}}</th>
                </tr>
            </thead>
            <tbody>
                {{#afEachArrayItem name="bills"}}
                <!--{{#if notNullLine this}}-->
                <tr class='js-autofill'>
                    <td>{{> afFormGroup name=this.current.id}}</td>
                    <td data-line="{{this.name}}">
                      <button type="button" class="btn btn-default js-full-amount"><i class="fa fa-arrow-right"></i> {{_ 'Full'}} <i class="fa fa-arrow-right"></i></button>
                    </td>
                    <td>{{> afFormGroup name=this.current.amount}}</td>
                    <td class="text-left">
                      <button type="button" class="btn btn-info autoform-remove-item">
                          <i class="fa fa-trash"></i>
                      </button>
                    </td>
                </tr>
                {{/afEachArrayItem}}
                <button type="button" class="btn btn-info autoform-add-item" data-autoform-field="bills">
                    <i class="fa fa-plus"></i> {{_ 'new'}} {{_ 'item'}}
                </button>
            </tbody>
        </table>
    </div>
    <div class="table-responsive m-t">
        <table class="table invoice-table">
            <thead>
                <tr>
                    <th>{{_ 'schemaPayments.lines.label'}}</th>
                    <th></th>
                    <th></th>
                    <th>{{_ 'schemaTransactions.amount.label'}}</th>
                </tr>
            </thead>
            <tbody>
                {{#afEachArrayItem name="lines"}}
                <!--{{#if notNullLine this}}-->
                <tr class='js-autofill'>
                    <td>{{> afFormGroup name=this.current.account}}</td>
                    <td>{{> afFormGroup name=this.current.localizer}}</td>
                    <td data-line="{{this.name}}">
                      <button type="button" class="btn btn-default js-remainder-amount"><i class="fa fa-arrow-down"></i> {{_ 'Remainder'}} <i class="fa fa-arrow-right"></i></button>
                    </td>
                    <td>{{> afFormGroup name=this.current.amount}}</td>
                    <td class="text-left">
                      <button type="button" class="btn btn-info autoform-remove-item">
                          <i class="fa fa-trash"></i>
                      </button>
                    </td>
                </tr>
                {{/afEachArrayItem}}
                <button type="button" class="btn btn-info autoform-add-item" data-autoform-field="lines">
                    <i class="fa fa-plus"></i> {{_ 'new'}} {{_ 'item'}}
                </button>
            </tbody>
        </table>
    </div>

    <table class="table invoice-total">
        <tbody>
        <tr>
            <td><strong>{{_ 'Allocated to bills'}} :</strong></td>
            <td class="nowrap">{{displayMoney allocatedToBillsAmount}}</td>
        </tr>
        <tr>
            <td><strong>{{_ 'Allocated to no bills'}} :</strong></td>
            <td class="nowrap">{{displayMoney allocatedToNonBillsAmount}}</td>
        </tr>
        <tr>
            <td><strong>{{_ 'Unallocated'}} :</strong></td>
            <td class="nowrap">{{displayMoney unallocatedAmount}}</td>
        </tr>
        </tbody>
    </table>

    <div class="well m-t">
        {{> afQuickField name="notes"}}
    </div>
</template>