<template name="Housing_page">
  <div class="content-scrollable page-content page-housing">
    
    <div style="width:100%;" class="white-box padded">
      {{#if community}}
      <div id="tab-content1" class="content">
        <div class="col-xs-8">
          <h1 id="houseName">{{community/name}}</h1>
        </div>
        <button type="button" class="primary" name="button"></button>
        <div class="row">
          <div class="col-xs-8">
            <h4 class="page-title">{{_ "community"}} {{_ "data"}}</h4>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-md-6 col-lg-4 pull-right">
            <div id="house_avatar">
              <a href="{{community/avatar}}" class="simple-lightbox"><img src="{{community/avatar}}" alt="community avatar" width="100%" /></a>
            </div>
            <div>
            {{#autoForm id="af.community.update" collection=communities omitFields="name,description,avatar" doc=community type=(autoformType community/_id) meteormethod="communities.update" singleMethodArgument=true template="bootstrap3"}}
              {{> afQuickFields}}
              {{#if userHasPermission 'communities.update' community/_id}}
                <div class="row">
                  <div class="col-xs-8">
                    <small>
                      <label><input type="checkbox"> {{_ "Acknowledge save effects" }}</label>
                    </small>
                  </div>
                  <div class="col-xs-4 text-right">
                    <button type="submit" class="btn btn-primary">{{_ "save"}}</button>
                  </div>
                </div>
              {{/if}}
              {{/autoForm}}
            </div>
          </div>
          <div class="col-xs-12 col-md-6 col-lg-8">
            <div>
              {{#autoForm id="af.community.name_update" collection=communities doc=community type=(autoformType community/_id) meteormethod="communities.update" singleMethodArgument=true template="bootstrap3"}}
              {{#if userHasPermission 'communities.update' community/_id}} 
                {{> afQuickField name='name'}}
                {{> afQuickField name='avatar'}}
              {{/if}}
              {{> afQuickField name='description' rows=12}}
              <!--{{#markdown}}{{{markdown_data}}}{{/markdown}}-->
              {{#if userHasPermission 'communities.update' community/_id}}
                <div class="row">
                  <div class="col-xs-8">
                    <small>
                      <label><input type="checkbox"> {{_ "Acknowledge save effects" }}</label>
                    </small>
                  </div>
                  <div class="col-xs-4 text-right">
                    <button type="submit" class="btn btn-primary">{{_ "save"}}</button>
                  </div>
                </div>
              {{/if}}
              {{/autoForm}}
            </div>
            <!--div class="form-group">
              <label for="houseName">Leírás</label>
              <textarea class="form-control vert" id="houseWelcome" placeholder="Welcome" rows="12"></textarea>
            </div-->
            <div class="roles-section">
              <div class="row">
                <div class="col-xs-12 text-center">
                  <h4 class="page-title">{{_ 'roles'}}</h4>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  {{> ReactiveDatatable tableData=rolesTableDataFn options=rolesOptionsFn }}
                </div>
              </div>
              {{#if userHasPermission 'roleships.create' community/_id}}
                <div class="row">
                  <div class="col-xs-12 text-center">
                    <button class="js-new btn btn-primary">{{_ 'createNew'}}</button>
                  </div>
                </div>
              {{/if}}
            </div>
          </div>
          <!--ul class="list-group no-style">
            {{#each countInfo in thingsToDisplayWithCounter}}
              <li><img src="/icon/si-glyph-mail-box.svg" width="20"/>{{_ countInfo/name}}: {{countInfo/count}}</li>
            {{/each}}
          </ul-->
        </div>
        {{#if userHasPermission 'parcels.inCommunity' community/_id}}
        <div class="parcels-section">
          <div class="row">
            <div class="col-xs-12">
              <hr>
              <h4>{{_ "Parcels of community"}}</h4>
              <br>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              {{#Collapse_section id='parcel' title='parcels' collapsed=true}}
                <!-- Approved section -->
                <div class="table-responsive">
                {{> ReactiveDatatable tableData=parcelsTableDataFn options=parcelsOptionsFn }}
                </div>
                {{#if userHasPermission 'parcels.insert' community/_id}}
                  <button class="js-new btn btn-primary">{{_ 'createNew'}}</button>
                {{/if}}
                <!-- UnApproved section -->
                {{#if hasUnapprovedParcels}}
                <h4 align="center">{{_ "Waiting for approval"}}</h4>
                <div class="table-responsive">
                {{> ReactiveDatatable tableData=unapprovedParcelsTableDataFn options=parcelsOptionsFn }}
                </div>
                {{/if}}
              {{/Collapse_section}}
            </div>
          </div>
        </div>
        {{/if}}
      </div>
      {{else}}
        {{_ "No active community"}}
      {{/if}}
    </div>
  </div>
  
  {{sortables}}
</template>
