<template name="Comments_section">
    <div class="social-footer comment-section" data-id="{{_id}}">
        {{#if hasMoreComments}}   
        <div class="social-comment">
            <a href="{{pathFor 'Topic show' _tid=_id}}">{{_ 'View previous comments' hasMoreComments}}</a>
        </div>
        {{/if}}
        {{#each comment in commentsOfTopic}}
            {{> Comment comment}}
        {{/each}}
      
        <div class="social-comment">
            <a href="" class="pull-left">
                <img alt="avatar" class="message-avatar" src={{currentUser.avatar}}>
            </a>
            <div class="media-body">
                <textarea  class="form-control js-send-enter" {{b "value: commentText"}} placeholder="{{_ 'newCommentPlaceholder'}}"></textarea>
                <div {{b "if: commentText"}} class="text-right">
                    <span class="js-send btn btn-xs btn-primary m-t-xs">{{_ 'send'}}</span>
                </div>
            </div>
        </div>
    </div>
</template>

<template name="Comment">
    <div class="social-comment">         
        <a href="{{pathFor 'User show' _id=this.user._id}}" class="pull-left">
            <img alt="avatar" class="message-avatar" src={{this.user.avatar}}>
        </a>
        <div class="media-body" >
            <a href="{{pathFor 'User show' _id=this.user._id}}">
                {{this.user}}
            </a>
            {{#if editing}}
                <textarea class="form-control" data-id="{{_id}}" value={{text}}></textarea>
                <div class="text-right">
                    <span class="js-cancel btn btn-xs btn-default m-t-xs">{{_ 'cancel'}}</span>
                    <span class="js-save btn btn-xs btn-primary m-t-xs">{{_ 'save'}}</span>
                </div>
            {{else}}
                {{#hideable}}
                    <span class="newlines" data-id="{{_id}}">{{>Chopped text=text}}</span>
                    <br/>
                    <a href="" class="small cap-first js-like">
                        <i class="fa {{#if this.isLikedBy currentUser._id}} fa-exclamation-circle {{else}} fa-hand-o-up {{/if}}"></i>
                        {{_ 'important'}}! ({{likesCount}})
                    </a> -
                    <small class="text-muted" title="{{displayTime createdAt}}">{{displayTimeFrom createdAt}}</small>
                    <div class="btn-group">
                        {{#if userHasPermission 'comments.update' (fromSession 'activeCommunityId') this}}
                        <button class="btn btn-white btn-xs js-edit" title="{{_ 'edit'}}"><i class="fa fa-pencil"></i></button>
                        {{/if}}
                        {{#if userHasPermission 'comments.remove' (fromSession 'activeCommunityId') this}}
                        <button class="btn btn-white btn-xs js-delete" title="{{_ 'delete'}}"><i class="fa fa-trash"></i></button>
                        {{/if}}
                        {{#if this.isFlaggedBy currentUser._id}}
                        <button class="btn btn-white btn-xs js-flag" title="{{_ 'Unblock content'}}"><i class="fa fa-check"></i></button>
                        {{else}}
                        <button class="btn btn-white btn-xs js-flag" title="{{_ 'Block content'}}"><i class="fa fa-ban"></i></button>
                        {{/if}}
                    </div>
                {{/hideable}}
            {{/if}}
        </div>
    </div>
</template>
