<template name="Votebox">
  <div class="vote-container white-box">
    <div class="row vote-title">
      <div class="col-xs-6 title-size">
        {{title}}
      </div>
      {{#if this.closed}}
      <div class="col-xs-6 text-right">
        <small class="writer">
          <i>{{_ 'createdAt'}}: {{displayCreatedAtTime}}</i>
        </small>
        <br>
        <button class="js-view-results">{{_ "closed"}}</button>
      </div>
      {{else}}
      <div class="col-xs-6 small-size text-right" data-tooltip="{{displayClosesAtTime}}">
        <small class="writer">
          <i>{{_ 'createdAt'}}: {{displayCreatedAtTime}}</i>
        </small>
        <br>
        {{_ "closes"}}: {{displayTimeLeft}}
        <!-- <button class="js-close">{{_ "close topic"}}</button> -->
      </div>
      {{/if}}
      <!-- dropdown at the right corner -->
      {{#if userHasPermission 'vote.close' (fromSession 'activeCommunityId') this}}
      <div class="dropdown text-right chat-dd-right">
          <button class="dropdown-toggle drop-unfoll glyphicon glyphicon-option-horizontal" type="button" id="drop_{{_id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          </button>
          <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="drop_{{_id}}">
            {{#if userHasPermission 'vote.close' (fromSession 'activeCommunityId') this}}
            <li><a class="js-close" href="#">{{_ 'close topic'}}</a></li>
            {{/if}}
            {{#if userHasPermission 'vote.update' (fromSession 'activeCommunityId') this}}
            <li><a class="js-edit" href="#">{{_ 'edit'}}</a></li>
            {{/if}}
            {{#if userHasPermission 'vote.remove' (fromSession 'activeCommunityId') this}}
            <li><a class="js-delete" href="#">{{_ 'delete'}}</a></li>
            {{/if}}
          </ul>
        </div>        
        {{/if}}
      </div>

    <div class="row vsend-col" style="margin-bottom: 20px;">
      <div class="col-xs-12 col-md-6">
        <br>
        {{#markdown}}{{text}}{{/markdown}}
      </div>
      <div class="col-xs-12 col-md-6">
        <br>
        {{#if this.closed}}
        <div class="row">
          <div class="col-xs-6">
            {{#each sum in this.voteSummaryDisplay}}
            <div>{{_ sum.choice}}: {{sum.votingShare}} ({{percentage sum.votingShare.toNumber}})</div><br>
            {{/each}}
          </div>
        </div>
        {{else}}
        <!-- voting buttons -->
        {{#if userHasPermission 'vote.cast' this/communityId this}}
        <div class="row">
          <div class="col-xs-12 vote-answer">

            {{#if voteTypeIs "preferential"}}
            <div class="row vote-answer-sort">
              {{#if voteIsFinalized}}
              {{else}}
              <div class="col-xs-12 text-center">
                {{_ 'rankedVotingInstructions'}}
              </div>
              {{/if}}
              <div class="col-xs-12 col-md-8 col-md-offset-2 text-center">
                <ul class="sortable droptrue {{pressedClassForPreferential}}">
                  {{#each currentPreference}}
                  <li class="ui-state-default" data-value="{{value}}"> <span class="glyphicon glyphicon-lock" aria-hidden="true"></span> {{text}}</li>
                  {{/each}}
                </ul>
              </div>
              <div class="col-xs-12 text-center">
                {{#if voteIsFinalized}}
                <button class="btn btn-default btn-votesend">{{_ 'change'}}</button>
                {{else}}
                <button class="btn btn-primary btn-votesend">{{_ 'finalize'}}</button>
                {{/if}}
              </div>
            </div>

            {{else}}
            <div class="row">
              <div class="col-xs-12">
                <div class="btns-group">
                  {{#each choice in vote.choices}}
                  <a href="#" class="btn-vote {{pressedClass @index}}" data-value="{{@index}}">
                    {{_ choice}}
                  </a>
                  {{/each}}
                </div>
                <!--button class="btn-primary btn-golive">{{_ 'vote'}}</button-->
              </div>
            </div>
            {{/if}}
          </div>
        </div>
        {{/if}}

        {{/if}}
      </div>
    </div>

      <div class="row">
      <div class="col-xs-12">
        {{> Comments_section this}}
      </div>
      </div>

  </div>
</template>

<template name="UserVoteStatus">
  <!-- showing if you voted directly or via delegation -->
  <div class="text-left">
  {{#if this.hasVotedDirect currentUser._id}}
      <span class="glyphicon glyphicon-record larger-icon" aria-hidden="true"></span> {{_ "You voted directly"}} - <a class="js-revoke">{{_ "revoke"}}</a>
  {{else}}
    {{#if this.hasVotedIndirect currentUser._id}}
      {{_ "You voted via delegation"}} - ({{_ "votedViaDelegationHint"}})
    {{else}}
      <img src="icon/warning.svg" width="17px">
      {{_ "You have not yet voted"}} - <i>({{_ "notYetVotedCastYourVoteOr"}} <a href="{{pathFor 'Delegations'}}">{{_ "setupYourDelegation"}}</a>)</i>
    {{/if}}
  {{/if}}
  </div>
</template>